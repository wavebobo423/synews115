<extend name="Base/base"/>
<block name="body">
    <ul class="breadcrumb">
        <li><a href="{:U('Industry/index')}"><i class="fa icon-home"></i></a></li>
        <li>{$channelName}</li>
    </ul>
    <div class="headline">
        <h2>{$channelName}</h2>
    </div>
    <div class="row">
        <div class="col-md-2 col-sm-2">
            
        </div>
        <div class="col-md-5 col-sm-8">
            <form role="form" action="{:U('banner/setBanner')}" method="post" id="banner_form">
                    <div class="form-group">
                        <label for="weight">权重</label>
                        <input type="text" name="weight" value="{$item.weight}" id="weight">
                    </div>
                    <div class="form-group">
                        <label for="exampleInputFile">商品序号ID<span style="font-size:14px;color:red;">(请使用英文逗号隔开。不要使用中文!例:",")</span> </label>
                        <input type="text" class="form-control" name="links" placeholder="请输入商品ID序列号/请用英文的逗号隔开" id="link" value="{$item.links}">
                    </div> 
                    <input type="hidden" name="id" value="{$item.id}">
                    <input type="hidden" name="cover" id="cover" value="{$item.cover}">
            </form>
            <form role="form" action="{:U('bannner/uploadImg')}" type="post" id="upload_form">
                <div id="queue"></div>
                <input id="file_upload" type="file" multiple="true">
                <empty name="item.cover">
                    <img id="preview_img" />
                <else />
                    <img src="{$item.cover}"/>
                </empty>
            </form>
            <hr>
            <button type="button" class="btn btn-default" id="add_banner">添加</button>

        </div>
        <div class="col-md-5 col-sm-2">
            
        </div>
    </div>
  
</block>
<block name="script">
    <script src="__STATIC__/plugins/uploadify/jquery.uploadify.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="__STATIC__/plugins/uploadify/uploadify.css">
    <script type="text/javascript">
        $(function(){
            $("#add_banner").click(function(){
                var link = $.trim($("#link").val());
                var cover = $.trim($("#cover").val());
                var weight = $.trim($("#weight").val());
                if(isNaN(weight)){
                    alert("请输入数字");
                    return false;
                }
                if(!link){
                    alert("请输入连接");
                    return false;
                }
                if(!cover){
                    alert("请上传图片");
                    return false;
                }
                $("#banner_form").submit();
            });

            <?php $timestamp = time();?>
            $('#file_upload').uploadify({
                'formData'     : {
                    'timestamp' : '<?php echo $timestamp;?>',
                    'token'     : '<?php echo md5('unique_salt' . $timestamp);?>'
                },
                'swf'      : '__STATIC__/plugins/uploadify/uploadify.swf',
                'uploader' : '{:U("banner/uploadImg")}',
                'onUploadSuccess': funComplete,          //完成上传任务
                'OnError': funError                             //上传发生错误时
            });
        
             //图片上传发生的事件
             function funComplete(fileObj, response, data) {
                // alert('上传事件');
                if (response == 0) {
                    alert('图片' + fileObj.name + '操作失败');
                    return false;
                }else{
                     $('#preview_img').attr('src',"__ROOT__/"+response);
                     $("#cover").val(response);
                     return true;
                }
             }
             //上传发生错误时。
             function funError(event, ID, fileObj, errorObj) {
                //alert('错误事件');
                alert(errorObj.info);
                return;
             }
        })
    </script>
</block>